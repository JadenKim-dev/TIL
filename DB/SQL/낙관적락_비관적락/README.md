# 낙관적 락 vs 비관적 락

낙관적 락(Optimistic Lock)과 비관적 락(Pessimistic Lock)은 데이터베이스에서 동시에 여러 사용자가 데이터를 접근할 때 데이터 일관성을 유지하기 위해 사용되는 두 가지 잠금(lock) 방식입니다.

### 1. **낙관적 락 (Optimistic Lock)**
- **기본 개념**:  
낙관적 락은 데이터를 수정할 때 충돌이 발생할 가능성이 낮다고 가정합니다.  
따라서 데이터를 읽을 때는 잠금을 걸지 않으며, 데이터를 실제로 업데이트할 때만 데이터 충돌을 체크합니다.

- **주요 특징**:
  - **충돌 감지**: 데이터를 업데이트할 때, 데이터의 버전 번호나 타임스탬프를 통해 데이터가 수정되었는지 확인합니다. 충돌이 발생하면 트랜잭션을 롤백하고 다시 시도하게 됩니다.
  - **성능**: 데이터 충돌이 드문 상황에서는 성능이 우수합니다. 다수의 읽기 작업이 있을 때 특히 유리합니다.
  - **사용 사례**: 주로 충돌이 거의 발생하지 않는 경우에 사용됩니다. 예를 들어, 트랜잭션이 짧고 자주 발생하지 않는 환경에서 유용합니다.

일반적으로 낙관적 락에서는 **데이터 수정 작업이 진행 중이라도 데이터 조회는 여전히 가능**합니다.

낙관적 락의 핵심은 다음과 같습니다:

**데이터 조회 시점**:  
데이터 조회를 할 때는 락이 걸리지 않습니다.  
즉, 데이터를 조회하는 동안에는 다른 트랜잭션이 동일한 데이터를 동시에 조회할 수 있으며, 심지어 수정할 수도 있습니다.

**데이터 수정 시점**:  
데이터를 수정하려고 할 때, 시스템은 이 데이터가 다른 트랜잭션에 의해 이미 수정되었는지(즉, 충돌이 발생했는지)를 감지합니다.  
이때 충돌이 발생하면 수정 작업이 실패하고 트랜잭션을 롤백할 수 있습니다.

따라서, 낙관적 락을 사용할 때는 **데이터가 수정 중인 상황에서도 다른 트랜잭션이 데이터를 조회**할 수 있습니다.  
그러나, 이러한 조회 작업은 나중에 데이터를 수정하려고 할 때 충돌이 발생할 수 있는 가능성을 높이게 됩니다.


### 2. **비관적 락 (Pessimistic Lock)**
- **기본 개념**:  
비관적 락은 데이터를 수정할 때 충돌이 발생할 가능성이 높다고 가정합니다.  
따라서 데이터를 읽을 때부터 잠금을 걸어, 다른 트랜잭션이 해당 데이터에 접근하지 못하게 합니다.

- **주요 특징**:
  - **락 유지**: 트랜잭션이 완료될 때까지 락이 유지되며, 다른 트랜잭션은 해당 데이터를 수정하거나 읽지 못합니다.
  - **성능**: 충돌이 자주 발생하는 환경에서 데이터 일관성을 유지하는 데 유리하지만, 락을 유지하는 동안 다른 트랜잭션이 대기해야 하므로 성능이 저하될 수 있습니다.
  - **사용 사례**: 데이터 충돌이 빈번하게 발생할 수 있는 상황, 트랜잭션이 길거나, 동시에 여러 트랜잭션이 동일한 데이터를 수정하려는 경우에 적합합니다.

### **비교 요약**
- **충돌 가정**: 낙관적 락은 충돌이 드물다고 가정하고, 비관적 락은 충돌이 빈번하다고 가정합니다.
- **락의 시점**: 낙관적 락은 업데이트 시점에서 충돌을 감지하며, 비관적 락은 읽는 시점에서부터 데이터를 잠급니다.
- **성능**: 낙관적 락은 트랜잭션이 짧고 충돌이 드문 경우에 성능이 좋고, 비관적 락은 충돌이 빈번할 때 데이터 일관성을 유지하는 데 유리합니다.

비관적 락(Pessimistic Lock)에서는 데이터 수정 중에 조회가 **불가능할 수 있습니다**.  
비관적 락은 데이터 일관성을 보장하기 위해, 데이터를 읽거나 수정할 때 다른 트랜잭션이 해당 데이터에 접근하지 못하도록 하는 것이 기본 목적입니다.

### 비관적 락에서의 조회 제약

- **수정 중 락이 걸린 데이터**:  
한 트랜잭션이 데이터를 수정하기 위해 비관적 락을 걸면, 그 데이터에 대한 잠금이 유지됩니다.  
이 잠금은 트랜잭션이 완료될 때까지 지속되며, 다른 트랜잭션은 해당 데이터에 접근할 수 없게 됩니다.
  
- **조회 요청 시도**:  
다른 트랜잭션이 이 잠금이 걸린 데이터를 조회하려고 하면, 그 트랜잭션은 해당 잠금이 해제될 때까지 대기 상태에 놓입니다.  
이는 조회 작업도 해당 데이터에 대해 대기를 해야 한다는 의미입니다. 

- **잠금의 종류**:  
비관적 락에는 읽기 잠금(Shared Lock)과 쓰기 잠금(Exclusive Lock) 두 가지가 있습니다.  
쓰기 잠금이 걸린 경우 다른 트랜잭션은 읽기조차도 할 수 없고, 대기해야 합니다.  
반면 읽기 잠금이 걸린 상태라면 다른 트랜잭션들도 읽기 작업을 할 수 있지만, 수정은 불가능합니다.

### 3. 비관적 베타락

비관적 베타락(Pessimistic Beta Lock)은 일반적인 비관적 락(Pessimistic Lock)의 한 형태로, 더 세밀한 잠금 관리가 필요한 경우에 사용됩니다.

### 비관적 베타락의 주요 특징

1. **세분화된 잠금**:  
베타락은 데이터베이스의 특정 행(row)이나 레코드(record)뿐만 아니라, 더 작은 단위, 예를 들어 필드(field) 단위로 잠금을 걸 수 있습니다.  
이를 통해 더 세밀한 잠금 제어가 가능하며, 데이터 경합을 최소화할 수 있습니다.

2. **낮은 충돌 가능성**:  
베타락은 데이터를 동시에 수정하는 여러 트랜잭션 간의 충돌 가능성을 줄이기 위해, 필요한 데이터 부분에만 잠금을 겁니다.  
이는 데이터베이스의 동시성을 최대한 유지하면서도 데이터 일관성을 보장하는 데 도움을 줍니다.

3. **수정 중 데이터 보호**:  
비관적 베타락에서는 데이터를 수정할 때 잠금을 걸어, 다른 트랜잭션이 동일한 데이터에 접근(읽기 또는 쓰기)하지 못하도록 합니다.  
이는 수정 중인 데이터가 외부 요인으로부터 보호되어, 데이터 일관성이 유지되도록 합니다.

4. **대기 및 데드락 관리**:  
베타락은 잠금 대기 및 데드락(교착 상태) 관리를 중요하게 여깁니다.  
잠금을 세밀하게 걸기 때문에, 시스템은 데드락을 방지하기 위해 특정 정책이나 알고리즘을 사용하여 트랜잭션을 관리합니다.

5. **트랜잭션 성능**:  
비관적 베타락을 사용할 경우, 트랜잭션의 성능이 저하될 수 있습니다.  
이는 잠금을 걸고 해제하는 과정에서 발생하는 오버헤드 때문입니다.  
그러나, 이는 데이터 일관성을 보장하기 위해 필수적인 대가로 간주됩니다.
